import{g as T,h as k,i as q,j as D,k as N,s as O,l as x,n as U,o as $,q as I,t as y,w as F,v as _,x as H,y as V,z as B,A as z,B as K,C as W}from"./vendor-CGyoh539.js";import{M as X}from"./markdown-BdO_TpYS.js";import"./firebase-BlrTpy7P.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&p(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const G="modulepreload",J=function(t){return"/RoR-Web-site/"+t},C={},E=function(e,s,p){let n=Promise.resolve();if(s&&s.length>0){let A=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");n=A(s.map(i=>{if(i=J(i),i in C)return;C[i]=!0;const d=i.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const c=document.createElement("link");if(c.rel=d?"stylesheet":G,d||(c.as="script"),c.crossOrigin="",c.href=i,r&&c.setAttribute("nonce",r),document.head.appendChild(c),d)return new Promise((b,w)=>{c.addEventListener("load",b),c.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return n.then(a=>{for(const r of a||[])r.status==="rejected"&&o(r.reason);return e().catch(o)})},M={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0},S=Object.entries(M).filter(([,t])=>!t).map(([t])=>t);if(S.length){const t=`[firebaseConfig] missing keys: ${S.join(", ")}`;console.error(t)}const j=T().length?k():q(M),Q=D(j),u=N(j);async function Y(t=1500){return u.currentUser!==null||await new Promise(e=>{const s=I(u,()=>{s(),e()});setTimeout(()=>{try{s()}catch{}e()},t)}),u.currentUser}async function Z(){try{await O(u,x)}catch(e){console.warn("[auth] localPersistence NG → inMemory",e?.code||e);try{await O(u,U)}catch(s){console.error("[auth] setPersistence failed",s?.code||s)}}const t=await Y();if(t)return t;if(typeof navigator<"u"&&navigator.onLine===!1)return console.warn("[auth] offline, skip signInAnonymously"),null;try{return(await $(u)).user}catch(e){return e?.code==="auth/network-request-failed"?(console.warn("[auth] network-request-failed, continue without auth"),null):(console.error("[auth] anonymous sign-in failed",e?.code,e?.message||e),null)}}const ee=500,te=10,ne={__name:"App",setup(t){const e=new X({breaks:!0}),s=Object.assign({"./content/1.基本.md":()=>E(()=>import("./1.基本-BllvYrDA.js"),[]),"./content/2.players.md":()=>E(()=>import("./2.players-IYwVCbU4.js"),[]),"./content/3.略語集.md":()=>E(()=>import("./3.略語集-MdPddEiQ.js"),[]),"./content/4.リンク.md":()=>E(()=>import("./4.リンク-Bb9p9_Ht.js"),[])}),p=y([]),n=y(null),o=y("");async function a(){const l=[];for(const[h,f]of Object.entries(s)){const v=await f(),g=(v.split(/\r?\n/).find(R=>R.trim())||"").replace(/^#\s*/,""),L=h.split("/").pop().replace(/\.md$/,"");l.push({id:L,title:g||L,raw:v})}l.sort((h,f)=>h.id.localeCompare(f.id,"ja")),p.value=l,!n.value&&l.length&&(n.value=l[0].id)}F(n,()=>{const l=p.value.find(h=>h.id===n.value);o.value=l?e.render(l.raw):""}),y("");const r=y(""),A=y([]),i=_(()=>r.value.length),d=_(()=>r.value?r.value.split(/\r\n|\r|\n/).length:0),m=_(()=>i.value>ee),c=_(()=>d.value>te);_(()=>!!r.value.trim()&&!m.value&&!c.value);const b=H(Q,"messages"),w=y(null);return V(async()=>{console.log("[mounted] start"),await a();const l=await Z();w.value=l,console.log("[ensureAnonLogin] uid =",w.value?.uid),I(u,f=>{w.value=f,console.log("[onAuthStateChanged] uid =",f?.uid)}),window._auth=u,window._me=w,window._topics=p;const h=B(b,z("created_at","desc"));K(h,f=>{A.value=f.docs.map(v=>{const g=v.data(),L=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:v.id,name:g.name||"名無し",text:g.text||"",at:L.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",A.value[0])}),console.log("[mounted] done")}),()=>{}}};function P(t){const e=document.createElement("pre");e.style.cssText="white-space:pre-wrap;padding:16px;background:#fff;color:#c00;border:1px solid #f99;font-family:monospace",e.textContent=`起動時エラー:
`+(t?.stack||t),document.body.innerHTML="",document.body.appendChild(e)}try{const t=W(ne);t.config.errorHandler=e=>P(e),window.addEventListener("error",e=>P(e.error||e.message)),window.addEventListener("unhandledrejection",e=>P(e.reason)),t.mount("#app")}catch(t){P(t)}
//# sourceMappingURL=index-Bp2njihR.js.map
