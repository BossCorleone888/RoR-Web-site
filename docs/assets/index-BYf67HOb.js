import{r as _,c as h,o as V,a as i,b as d,d as e,F as I,e as M,f as A,w as S,g as D,v as O,n as k,t as u,h as N,i as q}from"./vue-DIsLCQsJ.js";import{M as B}from"./markdown-BMSQkwth.js";import{g as E,a as R,i as z,b as X,c as $,s as W,d as G,e as J,f as Q,o as Y,q as Z,h as ee,j as te,k as se,l as x,m as oe,n as ne,p as ae}from"./firebase-D--XAbFQ.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function m(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const le={apiKey:"（Web API Key）",authDomain:"（your-project-id）.firebaseapp.com",projectId:"（your-project-id）",appId:"（your app id）"},b=E().length?R():z(le),P=X(b),f=$(b);console.log("[firebase] projectId=",b.options.projectId," apiKey=",String(b.options.apiKey).slice(0,8)+"...");async function re(){await W(f,J);try{if(f.currentUser)return f.currentUser;const l=await G(f);return console.log("[anon] ok uid=",l.user?.uid),l.user}catch(l){throw console.error("[anon] error code=",l?.code," message=",l?.message,l),alert("匿名サインイン失敗: "+(l?.code||"unknown")),l}}const ie={class:"layout-pc"},de={class:"sidenav"},ce={class:"sidenav-inner"},ue={"aria-label":"サイドナビ"},pe={class:"nav-list"},me=["onClick","aria-current"],ve={class:"nav-text"},fe={class:"content"},ge={class:"panel"},he=["innerHTML"],ye={key:1,class:"loading"},_e={class:"sidebar"},be={class:"pad"},we={class:"hint"},Ae={class:"row"},ke=["disabled"],Ce={class:"card list"},Le={class:"posts"},Ie={class:"meta"},Me={class:"name"},Se={class:"time"},De=["onClick"],Oe=["textContent"],Ne={key:0,class:"empty"},j=500,K=10,xe={__name:"App",setup(l){new B({breaks:!0});const p=_(""),r=_(""),m=_([]),o=h(()=>r.value.length),a=h(()=>r.value?r.value.split(/\r\n|\r|\n/).length:0),v=h(()=>o.value>j),C=h(()=>a.value>K),L=h(()=>!!r.value.trim()&&!v.value&&!C.value),w=Q(P,"messages"),c=_(null);V(async()=>{console.log("[mounted] start");const n=await re();c.value=n,console.log("[ensureAnonLogin] uid =",c.value?.uid),Y(f,s=>{c.value=s,console.log("[onAuthStateChanged] uid =",s?.uid)}),window._auth=f,window._me=c;const t=Z(w,ee("created_at","desc"));te(t,s=>{m.value=s.docs.map(y=>{const g=y.data(),U=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:y.id,name:g.name||"名無し",text:g.text||"",at:U.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",m.value[0])}),console.log("[mounted] done")});function F(){const n=r.value.trim(),t=p.value.trim()||"名無し";L.value&&oe(w,{name:t,text:n,created_at:ae(),uid:c.value?.uid??null}).then(()=>{r.value="",console.log("[addDoc] ok, uid=",c.value?.uid)}).catch(s=>{console.error("[addDoc] error",s)})}async function H(n){try{console.log("[delete] try id=",n),await x(ne(P,"messages",n)),console.log("[delete] ok id=",n)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function T(){if(!confirm("全投稿を削除しますか？"))return;const n=await se(w);for(const t of n.docs)await x(t.ref)}return(n,t)=>(d(),i("div",ie,[e("aside",de,[e("div",ce,[t[3]||(t[3]=e("div",{class:"logo"},"MENU",-1)),e("nav",ue,[e("ul",pe,[(d(!0),i(I,null,M(n.topics,s=>(d(),i("li",{key:s.id},[e("a",{href:"#",class:k(["nav-link",{active:s.id===n.selectedId}]),onClick:S(y=>n.selectedId=s.id,["prevent"]),"aria-current":s.id===n.selectedId?"page":void 0},[t[2]||(t[2]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",ve,u(s.title),1)],10,me)]))),128))])])])]),e("main",fe,[t[4]||(t[4]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[5]||(t[5]=e("p",{class:"lead"},[A("ここではメンバー向けに "),e("strong",null,"ルール"),A(" や "),e("strong",null,"ノウハウ"),A(" を共有します。")],-1)),e("section",ge,[n.selectedHtml?(d(),i("article",{key:0,class:"md",innerHTML:n.selectedHtml},null,8,he)):(d(),i("div",ye,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",_e,[e("div",be,[t[10]||(t[10]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:S(F,["prevent"]),class:"card"},[t[7]||(t[7]=e("label",{class:"lbl"},"ニックネーム",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[O,p.value]]),t[8]||(t[8]=e("label",{class:"lbl"},"メッセージ",-1)),D(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[O,r.value]]),e("div",we,[e("span",{class:k({over:v.value})},u(o.value)+"/"+u(j)+"文字",3),t[6]||(t[6]=e("span",null,"・",-1)),e("span",{class:k({over:C.value})},u(a.value)+"/"+u(K)+"行",3)]),e("div",Ae,[e("button",{class:"btn-primary",type:"submit",disabled:!L.value},"投稿",8,ke),e("button",{class:"btn-danger",type:"button",onClick:T},"全削除")])],32),e("div",Ce,[t[9]||(t[9]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",Le,[(d(!0),i(I,null,M(m.value,s=>(d(),i("li",{key:s.id,class:"post"},[e("div",Ie,[e("strong",Me,u(s.name||"名無し"),1),e("small",Se,u(s.at),1),s.uid&&c.value&&s.uid===c.value.uid?(d(),i("button",{key:0,class:"btn-mini",type:"button",onClick:y=>H(s.id)}," 削除 ",8,De)):N("",!0)]),e("div",{class:"text",textContent:u(s.text)},null,8,Oe)]))),128)),m.value.length===0?(d(),i("li",Ne,"まだ投稿はありません。")):N("",!0)])]),t[11]||(t[11]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])]))}};q(xe).mount("#app");
