import{r as y,c as h,o as B,a as r,b as d,d as k,e,f as w,t as l,F as C,g as D,w as M,h as S,v as x,n as A,i as R}from"./vue-DcwsL7RE.js";import{M as $}from"./markdown-BMSQkwth.js";import{g as j,a as z,i as K,b as X,c as G,s as J,d as Q,e as W,f as Y,o as Z,q as ee,h as te,j as se,k as ne,l as O,m as oe,n as ae,p as le}from"./firebase-D--XAbFQ.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))v(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&v(m)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function v(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const F={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0};for(const[c,u]of Object.entries(F))if(!u)throw new Error(`[firebaseConfig] ${c} is missing`);const H=j().length?z():K(F),N=X(H),f=G(H);async function ie(){await J(f,W);try{return f.currentUser?f.currentUser:(await Q(f)).user}catch(c){throw console.error("[anon] error",c?.code,c?.message),c}}const re={key:0,style:{position:"fixed",right:"8px",bottom:"8px","z-index":"9999",background:"#111",color:"#0f0",padding:"10px","border-radius":"8px","max-width":"90vw",font:"12px/1.4 monospace"}},de={class:"layout-pc"},ue={class:"sidenav"},ce={class:"sidenav-inner"},pe={"aria-label":"サイドナビ"},ve={class:"nav-list"},me=["onClick","aria-current"],fe={class:"nav-text"},ge={class:"content"},he={class:"panel"},be=["innerHTML"],ye={key:1,class:"loading"},we={class:"sidebar"},_e={class:"pad"},ke={class:"hint"},Ce={class:"row"},Ae=["disabled"],Ie={class:"card list"},Le={class:"posts"},De={class:"meta"},Me={class:"name"},Se={class:"time"},xe=["onClick"],Oe=["textContent"],Ne={key:0,class:"empty"},P=500,E=10,Pe={__name:"App",setup(c){new $({breaks:!0});const u=y(""),i=y(""),v=y([]),o=h(()=>i.value.length),a=h(()=>i.value?i.value.split(/\r\n|\r|\n/).length:0),m=h(()=>o.value>P),I=h(()=>a.value>E),L=h(()=>!!i.value.trim()&&!m.value&&!I.value),_=Y(N,"messages"),p=y(null);B(async()=>{console.log("[mounted] start");const n=await ie();p.value=n,console.log("[ensureAnonLogin] uid =",p.value?.uid),Z(f,s=>{p.value=s,console.log("[onAuthStateChanged] uid =",s?.uid)}),window._auth=f,window._me=p;const t=ee(_,te("created_at","desc"));se(t,s=>{v.value=s.docs.map(b=>{const g=b.data(),q=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:b.id,name:g.name||"名無し",text:g.text||"",at:q.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",v.value[0])}),console.log("[mounted] done")});function T(){const n=i.value.trim(),t=u.value.trim()||"名無し";L.value&&oe(_,{name:t,text:n,created_at:le(),uid:p.value?.uid??null}).then(()=>{i.value="",console.log("[addDoc] ok, uid=",p.value?.uid)}).catch(s=>{console.error("[addDoc] error",s)})}async function U(n){try{console.log("[delete] try id=",n),await O(ae(N,"messages",n)),console.log("[delete] ok id=",n)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function V(){if(!confirm("全投稿を削除しますか？"))return;const n=await ne(_);for(const t of n.docs)await O(t.ref)}return(n,t)=>(d(),r(C,null,[n.debugInfo.show?(d(),r("div",re,[e("div",null,[t[3]||(t[3]=e("b",null,"Diag",-1)),t[4]||(t[4]=w()),e("button",{onClick:t[0]||(t[0]=s=>n.runDiag()),style:{"margin-left":"8px"}},"Run")]),e("div",null,"step: "+l(n.debugInfo.step),1),e("div",null,"fetch: "+l(n.debugInfo.fetch),1),e("div",null,"anon : "+l(n.debugInfo.anon),1)])):k("",!0),e("div",de,[e("aside",ue,[e("div",ce,[t[6]||(t[6]=e("div",{class:"logo"},"MENU",-1)),e("nav",pe,[e("ul",ve,[(d(!0),r(C,null,D(n.topics,s=>(d(),r("li",{key:s.id},[e("a",{href:"#",class:A(["nav-link",{active:s.id===n.selectedId}]),onClick:M(b=>n.selectedId=s.id,["prevent"]),"aria-current":s.id===n.selectedId?"page":void 0},[t[5]||(t[5]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",fe,l(s.title),1)],10,me)]))),128))])])])]),e("main",ge,[t[7]||(t[7]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[8]||(t[8]=e("p",{class:"lead"},[w("ここではメンバー向けに "),e("strong",null,"ルール"),w(" や "),e("strong",null,"ノウハウ"),w(" を共有します。")],-1)),e("section",he,[n.selectedHtml?(d(),r("article",{key:0,class:"md",innerHTML:n.selectedHtml},null,8,be)):(d(),r("div",ye,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",we,[e("div",_e,[t[13]||(t[13]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:M(T,["prevent"]),class:"card"},[t[10]||(t[10]=e("label",{class:"lbl"},"ニックネーム",-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[x,u.value]]),t[11]||(t[11]=e("label",{class:"lbl"},"メッセージ",-1)),S(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value=s),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[x,i.value]]),e("div",ke,[e("span",{class:A({over:m.value})},l(o.value)+"/"+l(P)+"文字",3),t[9]||(t[9]=e("span",null,"・",-1)),e("span",{class:A({over:I.value})},l(a.value)+"/"+l(E)+"行",3)]),e("div",Ce,[e("button",{class:"btn-primary",type:"submit",disabled:!L.value},"投稿",8,Ae),e("button",{class:"btn-danger",type:"button",onClick:V},"全削除")])],32),e("div",Ie,[t[12]||(t[12]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",Le,[(d(!0),r(C,null,D(v.value,s=>(d(),r("li",{key:s.id,class:"post"},[e("div",De,[e("strong",Me,l(s.name||"名無し"),1),e("small",Se,l(s.at),1),s.uid&&p.value&&s.uid===p.value.uid?(d(),r("button",{key:0,class:"btn-mini",type:"button",onClick:b=>U(s.id)}," 削除 ",8,xe)):k("",!0)]),e("div",{class:"text",textContent:l(s.text)},null,8,Oe)]))),128)),v.value.length===0?(d(),r("li",Ne,"まだ投稿はありません。")):k("",!0)])]),t[14]||(t[14]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])])],64))}};R(Pe).mount("#app");
