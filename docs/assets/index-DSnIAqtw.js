import{g as D,h as R,i as T,j as k,k as N,s as O,l as q,n as B,o as F,q as x,t as y,w as U,v as _,x as $,y as H,z as V,A as z,B as G,C as K}from"./vendor-CGyoh539.js";import{M as W}from"./markdown-BdO_TpYS.js";import"./firebase-BlrTpy7P.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&p(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const X="modulepreload",J=function(t){return"/RoR-Web-site/"+t},C={},E=function(e,s,p){let n=Promise.resolve();if(s&&s.length>0){let L=function(i){return Promise.all(i.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");n=L(s.map(i=>{if(i=J(i),i in C)return;C[i]=!0;const u=i.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":X,u||(c.as="script"),c.crossOrigin="",c.href=i,r&&c.setAttribute("nonce",r),document.head.appendChild(c),u)return new Promise((P,w)=>{c.addEventListener("load",P),c.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return n.then(a=>{for(const r of a||[])r.status==="rejected"&&o(r.reason);return e().catch(o)})},S={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0};console.log("[FB CFG]",{apiKey:!1,authDomain:void 0,projectId:void 0,appId:void 0},"PROD=",!0);const I=Object.entries(S).filter(([,t])=>!t).map(([t])=>t);if(I.length){const t=`[firebaseConfig] missing keys: ${I.join(", ")}`;console.error(t)}const M=D().length?R():T(S),Q=k(M),d=N(M);async function Y(t=1500){return d.currentUser!==null||await new Promise(e=>{const s=x(d,()=>{s(),e()});setTimeout(()=>{try{s()}catch{}e()},t)}),d.currentUser}async function Z(){try{await O(d,q)}catch(e){console.warn("[auth] localPersistence NG → inMemory",e?.code||e);try{await O(d,B)}catch(s){console.error("[auth] setPersistence failed",s?.code||s)}}const t=await Y();if(t)return t;if(typeof navigator<"u"&&navigator.onLine===!1)return console.warn("[auth] offline, skip signInAnonymously"),null;try{return(await F(d)).user}catch(e){return e?.code==="auth/network-request-failed"?(console.warn("[auth] network-request-failed, continue without auth"),null):(console.error("[auth] anonymous sign-in failed",e?.code,e?.message||e),null)}}const ee=500,te=10,ne={__name:"App",setup(t){const e=new W({breaks:!0}),s=Object.assign({"./content/1.基本.md":()=>E(()=>import("./1.基本-BllvYrDA.js"),[]),"./content/2.players.md":()=>E(()=>import("./2.players-IYwVCbU4.js"),[]),"./content/3.略語集.md":()=>E(()=>import("./3.略語集-MdPddEiQ.js"),[]),"./content/4.リンク.md":()=>E(()=>import("./4.リンク-Bb9p9_Ht.js"),[])}),p=y([]),n=y(null),o=y("");async function a(){const l=[];for(const[h,f]of Object.entries(s)){const v=await f(),g=(v.split(/\r?\n/).find(j=>j.trim())||"").replace(/^#\s*/,""),A=h.split("/").pop().replace(/\.md$/,"");l.push({id:A,title:g||A,raw:v})}l.sort((h,f)=>h.id.localeCompare(f.id,"ja")),p.value=l,!n.value&&l.length&&(n.value=l[0].id)}U(n,()=>{const l=p.value.find(h=>h.id===n.value);o.value=l?e.render(l.raw):""}),y("");const r=y(""),L=y([]),i=_(()=>r.value.length),u=_(()=>r.value?r.value.split(/\r\n|\r|\n/).length:0),m=_(()=>i.value>ee),c=_(()=>u.value>te);_(()=>!!r.value.trim()&&!m.value&&!c.value);const P=$(Q,"messages"),w=y(null);return H(async()=>{console.log("[mounted] start"),await a();const l=await Z();w.value=l,console.log("[ensureAnonLogin] uid =",w.value?.uid),x(d,f=>{w.value=f,console.log("[onAuthStateChanged] uid =",f?.uid)}),window._auth=d,window._me=w,window._topics=p;const h=V(P,z("created_at","desc"));G(h,f=>{L.value=f.docs.map(v=>{const g=v.data(),A=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:v.id,name:g.name||"名無し",text:g.text||"",at:A.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",L.value[0])}),console.log("[mounted] done")}),()=>{}}};(function(){const e=document.createElement("div");e.style.cssText="position:fixed;z-index:99999;left:0;top:0;right:0;background:#111;color:#0f0;font:12px/1.4 monospace;padding:6px 8px",e.textContent="BOOTING... location="+location.href,document.addEventListener("DOMContentLoaded",()=>document.body.appendChild(e))})();function b(t){const e=document.createElement("pre");e.style.cssText="white-space:pre-wrap;padding:16px;background:#fff;color:#c00;border:1px solid #f99;font-family:monospace",e.textContent=`起動時エラー:
`+(t?.stack||t),document.body.innerHTML="",document.body.appendChild(e)}try{const t=K(ne);t.config.errorHandler=e=>b(e),window.addEventListener("error",e=>b(e.error||e.message)),window.addEventListener("unhandledrejection",e=>b(e.reason)),t.mount("#app")}catch(t){b(t)}
//# sourceMappingURL=index-DSnIAqtw.js.map
