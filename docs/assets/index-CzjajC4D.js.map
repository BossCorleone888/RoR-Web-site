{"version":3,"mappings":"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","names":["firebaseConfig","missing","v","k","msg","app","getApps","getApp","initializeApp","db","getFirestore","auth","getAuth","waitForAuthReady","timeoutMs","r","off","onAuthStateChanged","ensureAnonLogin","setPersistence","browserLocalPersistence","inMemoryPersistence","e2","ready","signInAnonymously","MAX_CHARS","MAX_LINES","md","MarkdownIt","mdLoaders","__vitePreload","topics","ref","selectedId","selectedHtml","loadTopics","items","path","loader","raw","first","l","id","a","b","watch","t","x","newMessage","messages","charCount","computed","lineCount","isCharOver","isLineOver","col","collection","me","onMounted","user","u","q","query","orderBy","onSnapshot","snap","d","data","dt","showFatal","e","pre","createApp","App","err"],"ignoreList":[],"sources":["../../src/lib/firebase.js","../../src/App.vue","../../src/main.js"],"sourcesContent":["// src/lib/firebase.js\r\nimport { initializeApp, getApps, getApp } from 'firebase/app'\r\nimport { getFirestore, serverTimestamp as ts } from 'firebase/firestore'\r\nimport {\r\n  getAuth, setPersistence, browserLocalPersistence, inMemoryPersistence,\r\n  signInAnonymously, onAuthStateChanged\r\n} from 'firebase/auth'\r\n\r\nconst firebaseConfig = {\r\n  apiKey:      import.meta.env.VITE_FB_API_KEY,\r\n  authDomain:  import.meta.env.VITE_FB_AUTH_DOMAIN,\r\n  projectId:   import.meta.env.VITE_FB_PROJECT_ID,\r\n  appId:       import.meta.env.VITE_FB_APP_ID,\r\n}\r\n\r\nconst missing = Object.entries(firebaseConfig).filter(([,v])=>!v).map(([k])=>k)\r\nif (missing.length) {\r\n  const msg = `[firebaseConfig] missing keys: ${missing.join(', ')}`\r\n  if (import.meta.env.DEV) throw new Error(msg); else console.error(msg)\r\n}\r\n\r\nconst app = getApps().length ? getApp() : initializeApp(firebaseConfig)\r\nexport const db = getFirestore(app)\r\nexport const auth = getAuth(app)\r\nexport { ts }\r\n\r\nasync function waitForAuthReady(timeoutMs=1500){\r\n  if (auth.currentUser !== null) return auth.currentUser\r\n  await new Promise(r=>{\r\n    const off = onAuthStateChanged(auth, ()=>{ off(); r() })\r\n    setTimeout(()=>{ try{off()}catch{}; r() }, timeoutMs)\r\n  })\r\n  return auth.currentUser\r\n}\r\n\r\nexport async function ensureAnonLogin(){\r\n  try { await setPersistence(auth, browserLocalPersistence) }\r\n  catch(e){ try{ await setPersistence(auth, inMemoryPersistence) }catch(e2){ console.error('[auth] setPersistence failed', e2) } }\r\n\r\n  const ready = await waitForAuthReady()\r\n  if (ready) return ready\r\n  if (typeof navigator!=='undefined' && navigator.onLine===false) { console.warn('[auth] offline'); return null }\r\n\r\n  try { const cred = await signInAnonymously(auth); return cred.user }\r\n  catch(e){\r\n    if (e?.code==='auth/network-request-failed'){ console.warn('[auth] network fail'); return null }\r\n    console.error('[auth] anon failed', e); return null\r\n  }\r\n}\r\n","<script setup>\nimport { ref, computed, onMounted, watch } from 'vue'\nimport MarkdownIt from 'markdown-it'\nimport { db, ensureAnonLogin, ts, auth } from './lib/firebase'\nimport { collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy, getDocs } from 'firebase/firestore'\nimport { onAuthStateChanged } from 'firebase/auth'\n\nconst md = new MarkdownIt({ breaks: true })\n\n/* =============== å·¦ã‚µã‚¤ãƒ‰ï¼šMarkdown ãƒ­ãƒ¼ãƒ‰ & æœ¬æ–‡ =============== */\n// Vite 5 ä»¥é™ã¯ as:'raw' ã˜ã‚ƒãªã query:'?raw' ã‚’æ¨å¥¨\nconst mdLoaders = import.meta.glob('./content/*.md', { query: '?raw' })\n\nconst topics = ref([])          // [{id,title,raw}]\nconst selectedId = ref(null)    // ç¾åœ¨é¸æŠä¸­ã® id\nconst selectedHtml = ref('')    // è¡¨ç¤ºç”¨ HTML\n\nasync function loadTopics() {\n  const items = []\n  for (const [path, loader] of Object.entries(mdLoaders)) {\n    const raw = await loader()\n    // æœ€åˆã®éç©ºè¡Œã‚’ã‚¿ã‚¤ãƒˆãƒ«ã«ï¼ˆå…ˆé ­ã® # ã‚’å‰¥ãŒã™ï¼‰\n    const first = (raw.split(/\\r?\\n/).find(l => l.trim()) || '').replace(/^#\\s*/, '')\n    const id = path.split('/').pop().replace(/\\.md$/, '')\n    items.push({ id, title: first || id, raw })\n  }\n  // 01_ 02_â€¦ å‰æã§å®‰å®šã‚½ãƒ¼ãƒˆ\n  items.sort((a, b) => a.id.localeCompare(b.id, 'ja'))\n  topics.value = items\n  if (!selectedId.value && items.length) selectedId.value = items[0].id\n}\n\nwatch(selectedId, () => {\n  const t = topics.value.find(x => x.id === selectedId.value)\n  selectedHtml.value = t ? md.render(t.raw) : ''\n})\n\n/* =============== å³ï¼šãƒ¡ãƒ³ãƒãƒ¼æŠ•ç¨¿ï¼ˆFirestoreå…±æœ‰ï¼‰ =============== */\nconst MAX_CHARS = 500\nconst MAX_LINES = 10\n\nconst nameInput = ref('')\nconst newMessage = ref('')\nconst messages = ref([])\n\nconst charCount = computed(() => newMessage.value.length)\nconst lineCount = computed(() => newMessage.value ? newMessage.value.split(/\\r\\n|\\r|\\n/).length : 0)\nconst isCharOver = computed(() => charCount.value > MAX_CHARS)\nconst isLineOver = computed(() => lineCount.value > MAX_LINES)\nconst canSubmit = computed(() => !!newMessage.value.trim() && !isCharOver.value && !isLineOver.value)\n\nconst col = collection(db, 'messages')\n\n// ğŸ”° ã“ã“ãŒè¶…é‡è¦ï¼šreactive ãªãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±\nconst me = ref(null)\n\nonMounted(async () => {\n  console.log('[mounted] start')\n\n  // --- å·¦ï¼šMarkdown èª­ã¿è¾¼ã¿\n  await loadTopics()\n\n  // â‘  åŒ¿åãƒ­ã‚°ã‚¤ãƒ³ã‚’â€œå¿…ãšâ€ç¢ºç«‹ï¼ˆå¤±æ•—ã—ã¦ã‚‚ null è¿”ã‚‹ã ã‘ã§ç”»é¢ã¯å‹•ãè¨­è¨ˆï¼‰\n  const user = await ensureAnonLogin()\n  me.value = user\n  console.log('[ensureAnonLogin] uid =', me.value?.uid)\n\n  // â‘¡ çŠ¶æ…‹å¤‰åŒ–ã‚‚æ‹¾ã†ï¼ˆä¿é™ºï¼‰\n  onAuthStateChanged(auth, (u) => {\n    me.value = u\n    console.log('[onAuthStateChanged] uid =', u?.uid)\n  })\n\n  // â‘¢ ãƒ‡ãƒãƒƒã‚°ç”¨\n  window._auth = auth\n  window._me = me\n  window._topics = topics\n\n  // â‘£ æŠ•ç¨¿ã®è³¼èª­\n  const q = query(col, orderBy('created_at', 'desc'))\n  onSnapshot(q, (snap) => {\n    messages.value = snap.docs.map(d => {\n      const data = d.data()\n      const dt = data.created_at?.toDate ? data.created_at.toDate() : new Date()\n      return {\n        id: d.id,\n        name: data.name || 'åç„¡ã—',\n        text: data.text || '',\n        at: dt.toLocaleString(),\n        uid: data.uid ?? null,\n      }\n    })\n    console.log('[onSnapshot] first=', messages.value[0])\n  })\n\n  console.log('[mounted] done')\n})\n\nfunction handleSubmit(){\n  const t = newMessage.value.trim()\n  const nm = nameInput.value.trim() || 'åç„¡ã—'\n  if(!canSubmit.value) return\n  addDoc(col, {\n    name: nm,\n    text: t,\n    created_at: ts(),\n    uid: me.value?.uid ?? null,\n  }).then(() => {\n    newMessage.value = ''\n    console.log('[addDoc] ok, uid=', me.value?.uid)\n  }).catch(e => {\n    console.error('[addDoc] error', e)\n  })\n}\n\nasync function removeOne(id){\n  try {\n    console.log('[delete] try id=', id)\n    await deleteDoc(doc(db, 'messages', id))\n    console.log('[delete] ok id=', id)\n  } catch (e) {\n    console.error('[delete] error', e)\n    alert('å‰Šé™¤ã«å¤±æ•—ã—ãŸã‹ã‚‚ã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ã­ã€‚')\n  }\n}\n\nasync function clearAll(){\n  if(!confirm('å…¨æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return\n  const snap = await getDocs(col)\n  for (const d of snap.docs) await deleteDoc(d.ref)\n}\n</script>\n","// src/main.js\nimport { createApp } from 'vue'\nimport App from './App.vue'\n\nfunction showFatal(e){\n  const pre = document.createElement('pre')\n  pre.style.cssText='white-space:pre-wrap;padding:16px;background:#fff;color:#c00;border:1px solid #f99;font-family:monospace'\n  pre.textContent='èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼:\\n'+(e?.stack||e)\n  document.body.innerHTML=''; document.body.appendChild(pre)\n}\ntry{\n  const app = createApp(App)\n  app.config.errorHandler = (err)=>showFatal(err)\n  window.addEventListener('error', e=>showFatal(e.error||e.message))\n  window.addEventListener('unhandledrejection', e=>showFatal(e.reason))\n  app.mount('#app')\n}catch(e){ showFatal(e) }\n"],"file":"assets/index-CzjajC4D.js"}