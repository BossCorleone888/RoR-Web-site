import{r as b,c as h,o as E,a as d,b as u,d as k,e,f as w,t as r,F as A,g as M,w as D,h as S,v as x,n as C,i as $}from"./vue-DcwsL7RE.js";import{M as z}from"./markdown-BMSQkwth.js";import{g as K,a as X,i as G,b as J,c as Q,s as O,d as W,e as Y,f as Z,o as T,h as ee,q as te,j as se,k as ne,l as oe,m as P,n as ae,p as le,r as ie}from"./firebase-BHgPUD_C.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))m(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const v of i.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function l(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(a){if(a.ep)return;a.ep=!0;const i=l(a);fetch(a.href,i)}})();const U={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0};{const c=Object.entries(U).filter(([,s])=>!s).map(([s])=>s);if(c.length){const s=`[firebaseConfig] missing keys: ${c.join(", ")}`;console.error(s)}}const H=K().length?X():G(U),N=J(H),p=Q(H);async function re(c=5e3){return p.currentUser!==null||await new Promise(s=>{const l=T(p,()=>{l(),s()});setTimeout(()=>{try{l()}catch{}s()},c)}),p.currentUser}async function de(){try{await O(p,W)}catch(s){console.warn("[auth] browserLocalPersistence unavailable, fallback to inMemory.",s?.code||s);try{await O(p,Y)}catch(l){console.error("[auth] setPersistence failed.",l?.code||l)}}const c=await re(1500);if(c)return c;if(typeof navigator<"u"&&navigator&&navigator.onLine===!1)return console.warn("[auth] offline detected, skip signInAnonymously."),null;try{return(await Z(p)).user}catch(s){return s?.code==="auth/network-request-failed"?(console.warn("[auth] network-request-failed (offline or blocked). App continues without auth."),null):(console.error("[auth] anonymous sign-in failed:",s?.code,s?.message||s),null)}}const ue={key:0,style:{position:"fixed",right:"8px",bottom:"8px","z-index":"9999",background:"#111",color:"#0f0",padding:"10px","border-radius":"8px","max-width":"90vw",font:"12px/1.4 monospace"}},ce={class:"layout-pc"},pe={class:"sidenav"},fe={class:"sidenav-inner"},me={"aria-label":"サイドナビ"},ve={class:"nav-list"},ge=["onClick","aria-current"],he={class:"nav-text"},ye={class:"content"},be={class:"panel"},we=["innerHTML"],_e={key:1,class:"loading"},ke={class:"sidebar"},Ae={class:"pad"},Ce={class:"hint"},Le={class:"row"},Ie=["disabled"],Me={class:"card list"},De={class:"posts"},Se={class:"meta"},xe={class:"name"},Oe={class:"time"},Pe=["onClick"],Ne=["textContent"],qe={key:0,class:"empty"},q=500,F=10,Fe={__name:"App",setup(c){new z({breaks:!0});const s=b(""),l=b(""),m=b([]),a=h(()=>l.value.length),i=h(()=>l.value?l.value.split(/\r\n|\r|\n/).length:0),v=h(()=>a.value>q),L=h(()=>i.value>F),I=h(()=>!!l.value.trim()&&!v.value&&!L.value),_=ee(N,"messages"),f=b(null);E(async()=>{console.log("[mounted] start");const o=await de();f.value=o,console.log("[ensureAnonLogin] uid =",f.value?.uid),T(p,n=>{f.value=n,console.log("[onAuthStateChanged] uid =",n?.uid)}),window._auth=p,window._me=f;const t=te(_,se("created_at","desc"));ne(t,n=>{m.value=n.docs.map(y=>{const g=y.data(),B=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:y.id,name:g.name||"名無し",text:g.text||"",at:B.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",m.value[0])}),console.log("[mounted] done")});function R(){const o=l.value.trim(),t=s.value.trim()||"名無し";I.value&&ae(_,{name:t,text:o,created_at:ie(),uid:f.value?.uid??null}).then(()=>{l.value="",console.log("[addDoc] ok, uid=",f.value?.uid)}).catch(n=>{console.error("[addDoc] error",n)})}async function V(o){try{console.log("[delete] try id=",o),await P(le(N,"messages",o)),console.log("[delete] ok id=",o)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function j(){if(!confirm("全投稿を削除しますか？"))return;const o=await oe(_);for(const t of o.docs)await P(t.ref)}return(o,t)=>(u(),d(A,null,[o.debugInfo.show?(u(),d("div",ue,[e("div",null,[t[3]||(t[3]=e("b",null,"Diag",-1)),t[4]||(t[4]=w()),e("button",{onClick:t[0]||(t[0]=n=>o.runDiag()),style:{"margin-left":"8px"}},"Run")]),e("div",null,"step: "+r(o.debugInfo.step),1),e("div",null,"fetch: "+r(o.debugInfo.fetch),1),e("div",null,"anon : "+r(o.debugInfo.anon),1)])):k("",!0),e("div",ce,[e("aside",pe,[e("div",fe,[t[6]||(t[6]=e("div",{class:"logo"},"MENU",-1)),e("nav",me,[e("ul",ve,[(u(!0),d(A,null,M(o.topics,n=>(u(),d("li",{key:n.id},[e("a",{href:"#",class:C(["nav-link",{active:n.id===o.selectedId}]),onClick:D(y=>o.selectedId=n.id,["prevent"]),"aria-current":n.id===o.selectedId?"page":void 0},[t[5]||(t[5]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",he,r(n.title),1)],10,ge)]))),128))])])])]),e("main",ye,[t[7]||(t[7]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[8]||(t[8]=e("p",{class:"lead"},[w("ここではメンバー向けに "),e("strong",null,"ルール"),w(" や "),e("strong",null,"ノウハウ"),w(" を共有します。")],-1)),e("section",be,[o.selectedHtml?(u(),d("article",{key:0,class:"md",innerHTML:o.selectedHtml},null,8,we)):(u(),d("div",_e,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",ke,[e("div",Ae,[t[13]||(t[13]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:D(R,["prevent"]),class:"card"},[t[10]||(t[10]=e("label",{class:"lbl"},"ニックネーム",-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.value=n),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[x,s.value]]),t[11]||(t[11]=e("label",{class:"lbl"},"メッセージ",-1)),S(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>l.value=n),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[x,l.value]]),e("div",Ce,[e("span",{class:C({over:v.value})},r(a.value)+"/"+r(q)+"文字",3),t[9]||(t[9]=e("span",null,"・",-1)),e("span",{class:C({over:L.value})},r(i.value)+"/"+r(F)+"行",3)]),e("div",Le,[e("button",{class:"btn-primary",type:"submit",disabled:!I.value},"投稿",8,Ie),e("button",{class:"btn-danger",type:"button",onClick:j},"全削除")])],32),e("div",Me,[t[12]||(t[12]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",De,[(u(!0),d(A,null,M(m.value,n=>(u(),d("li",{key:n.id,class:"post"},[e("div",Se,[e("strong",xe,r(n.name||"名無し"),1),e("small",Oe,r(n.at),1),n.uid&&f.value&&n.uid===f.value.uid?(u(),d("button",{key:0,class:"btn-mini",type:"button",onClick:y=>V(n.id)}," 削除 ",8,Pe)):k("",!0)]),e("div",{class:"text",textContent:r(n.text)},null,8,Ne)]))),128)),m.value.length===0?(u(),d("li",qe,"まだ投稿はありません。")):k("",!0)])]),t[14]||(t[14]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])])],64))}};$(Fe).mount("#app");
