import{g as re,i as le,h as ie,j as ce,k as ue,s as z,l as de,n as pe,o as ve,q as J,t as fe,v as d,w as me,x as A,y as ge,z as ye,A as be,B as he,C as we,D as i,E as S,F as k,G as t,H as N,I as _e,J as f,K as Ce,M as Ae,N as T,O as B,Q as x,R as W,S as E,T as c,U as Se,V as ke,W as xe,X as Le}from"./vendor-B0cdf9Ys.js";import{M as Ie}from"./markdown-Dc59Dyhn.js";import"./firebase-Db-hts2P.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))g(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const w of l.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&g(w)}).observe(document,{childList:!0,subtree:!0});function p(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function g(o){if(o.ep)return;o.ep=!0;const l=p(o);fetch(o.href,l)}})();const Me="/RoR-Web-site/assets/ror-DutKwc0_.png",Z={apiKey:"AIzaSyCsOqpk7qzesQfNhIVb_Nm-lSAtWoNg2Z0",authDomain:"ror-web-site.firebaseapp.com",projectId:"ror-web-site",appId:"1:777517324792:web:5fe680dc85e91239d71e0d"},Oe=["apiKey","authDomain","projectId","appId"],$=Oe.filter(r=>!Z[r]);let H=null,R=null,u=null;if($.length===0)H=ie().length?re():le(Z),R=ce(H),u=ue(H);else{const r=`[firebaseConfig] missing: ${$.join(", ")}`;console.error(r)}const De=fe;async function Fe(r=1500){return u?(u.currentUser!==null||await new Promise(a=>{const p=J(u,()=>{p(),a()});setTimeout(()=>{try{p()}catch{}a()},r)}),u.currentUser):null}async function Ne(){if(!u)return null;try{await z(u,de)}catch{try{await z(u,pe)}catch{}}const r=await Fe();if(r)return r;if(typeof navigator<"u"&&navigator.onLine===!1)return null;try{return(await ve(u)).user}catch(a){return a?.code!=="auth/network-request-failed"&&console.error("[auth]",a?.code||a),null}}const Te={key:0,class:"gate"},Ee={class:"gate-card"},He={key:0,class:"gate-err"},Re={class:"layout-pc"},Ue={class:"sidenav"},je={class:"sidenav-inner"},Pe=["src"],Ke={"aria-label":"サイドナビ",class:"nav-wrap"},Ve={class:"nav-list"},qe=["onClick","aria-current"],Ge={class:"nav-text"},ze={class:"content"},Be={class:"panel"},We=["innerHTML"],$e={key:1,class:"loading"},Xe={class:"sidebar"},Qe={class:"pad"},Je={key:0,class:"card",style:{"border-color":"#f8cdcd",background:"#fff5f5"}},Ze=["aria-disabled"],Ye=["disabled"],et=["disabled"],tt={class:"hint"},st={class:"row"},at=["disabled"],nt={class:"card list"},ot={class:"posts"},rt={class:"meta"},lt={class:"name"},it={class:"time"},ct=["onClick"],ut=["textContent"],dt={key:0,class:"empty"},X=500,Q=10,pt={__name:"App",setup(r){const a="680192e6020488e6bc4b39d6a2f17aa682da9923a5aee92cfe2dc795752ae9f3".trim?.()||"",p=d(!a),g=d(""),o=d("");async function l(n){const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(n));return Array.from(new Uint8Array(e)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function w(){try{const n=await l(g.value);n===a?(p.value=!0,localStorage.setItem("siteGate",n),o.value="",g.value=""):o.value="パスワードが違うべさ"}catch{o.value="このブラウザは非対応かも（WebCryptoが必要）"}}function Y(){localStorage.removeItem("siteGate"),p.value=!1}const ee=new Ie({breaks:!0}),te=Object.assign({}),I=d([]),y=d(null),M=d("");async function se(){const n=[];for(const[e,s]of Object.entries(te)){const h=await s(),v=h?.default??h;if(typeof v!="string")continue;const F=(v.split(/\r?\n/).find(oe=>oe.trim())||"").replace(/^#\s*/,""),G=e.split("/").pop().replace(/\.md$/,"");n.push({id:G,title:F||G,raw:v})}n.sort((e,s)=>e.id.localeCompare(s.id,"ja")),I.value=n,!y.value&&n.length&&(y.value=n[0].id)}me(y,()=>{const n=I.value.find(e=>e.id===y.value);M.value=n?ee.render(n.raw):""});const O=d(""),m=d(""),D=d([]),_=d(null),b=d(!1);let C=null;const U=A(()=>m.value.length),j=A(()=>m.value?m.value.split(/\r\n|\r|\n/).length:0),P=A(()=>U.value>X),K=A(()=>j.value>Q),V=A(()=>!!m.value.trim()&&!P.value&&!K.value);ge(async()=>{if(a){const n=localStorage.getItem("siteGate");n&&n===a&&(p.value=!0)}if(await se(),R){b.value=!0;const n=await Ne();_.value=n,u&&J(u,s=>{_.value=s}),C=ye(R,"messages");const e=be(C,he("created_at","desc"));we(e,s=>{D.value=s.docs.map(h=>{const v=h.data(),F=v.created_at?.toDate?v.created_at.toDate():new Date;return{id:h.id,name:v.name||"名無し",text:v.text||"",at:F.toLocaleString(),uid:v.uid??null}})})}else console.warn("[App] Firebase 未設定：投稿UIは表示されるけど無効だべさ")});function q(){return!b.value||!C?(alert("Firebase未設定（.env.production.local を作ってビルドすると投稿できるべさ）"),!0):!1}function ae(){if(q())return;const n=m.value.trim(),e=O.value.trim()||"名無し";V.value&&Se(C,{name:e,text:n,created_at:De(),uid:_.value?.uid??null}).then(()=>{m.value=""}).catch(s=>{console.error("[addDoc] error",s)})}async function ne(n){if(!q())try{await ke(xe(C.firestore,"messages",n))}catch(e){console.error("[delete] error",e),alert("削除に失敗したかも。")}}return(n,e)=>(c(),i(T,null,[p.value?S("",!0):(c(),i("div",Te,[t("div",Ee,[e[3]||(e[3]=t("h3",null,"🔒 メンバー専用",-1)),e[4]||(e[4]=t("p",{class:"gate-tip"},"パスワードを入力して入室してね",-1)),k(t("input",{class:"input",type:"password","onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),placeholder:"パスワード",onKeyup:_e(w,["enter"])},null,544),[[N,g.value]]),t("button",{class:"btn-primary",onClick:w},"入る"),o.value?(c(),i("p",He,f(o.value),1)):S("",!0)])])),k(t("div",Re,[t("aside",Ue,[t("div",je,[t("img",{src:Ae(Me),alt:"RoR ロゴ",class:"brand-logo",decoding:"async"},null,8,Pe),e[7]||(e[7]=t("div",{class:"logo"},"MENU",-1)),t("nav",Ke,[t("ul",Ve,[(c(!0),i(T,null,B(I.value,s=>(c(),i("li",{key:s.id},[t("a",{href:"#",class:E(["nav-link",{active:s.id===y.value}]),onClick:W(h=>y.value=s.id,["prevent"]),"aria-current":s.id===y.value?"page":void 0},[e[5]||(e[5]=t("span",{class:"dot","aria-hidden":"true"},null,-1)),t("span",Ge,f(s.title),1)],10,qe)]))),128))]),e[6]||(e[6]=t("hr",{class:"side-sep"},null,-1)),t("button",{class:"btn-mini logout",onClick:Y,title:"ログアウト"},"ログアウト")])])]),t("main",ze,[e[8]||(e[8]=t("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),e[9]||(e[9]=t("p",{class:"lead"},[x("ここではメンバー向けに "),t("strong",null,"ルール"),x(" や "),t("strong",null,"ノウハウ"),x(" を共有します。")],-1)),t("section",Be,[M.value?(c(),i("article",{key:0,class:"md",innerHTML:M.value},null,8,We)):(c(),i("div",$e,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),t("aside",Xe,[t("div",Qe,[e[15]||(e[15]=t("h3",null,"✍️ メンバー書き込み",-1)),b.value?S("",!0):(c(),i("div",Je,[...e[10]||(e[10]=[t("strong",{style:{color:"#b20000"}},"Firebase未設定",-1),t("br",null,null,-1),x(" `.env.production.local` を作ってビルドすると投稿できるべさ。 ",-1)])])),t("form",{onSubmit:W(ae,["prevent"]),class:"card","aria-disabled":!b.value},[e[12]||(e[12]=t("label",{class:"lbl"},"ニックネーム",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>O.value=s),class:"input",placeholder:"例：Momo56 / 名無し など",disabled:!b.value},null,8,Ye),[[N,O.value]]),e[13]||(e[13]=t("label",{class:"lbl"},"メッセージ",-1)),k(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5",disabled:!b.value},null,8,et),[[N,m.value]]),t("div",tt,[t("span",{class:E({over:P.value})},f(U.value)+"/"+f(X)+"文字",3),e[11]||(e[11]=t("span",null,"・",-1)),t("span",{class:E({over:K.value})},f(j.value)+"/"+f(Q)+"行",3)]),t("div",st,[t("button",{class:"btn-primary",type:"submit",disabled:!V.value||!b.value},"投稿",8,at)])],40,Ze),t("div",nt,[e[14]||(e[14]=t("h4",null,"🗂 最新の投稿",-1)),t("ul",ot,[(c(!0),i(T,null,B(D.value,s=>(c(),i("li",{key:s.id,class:"post"},[t("div",rt,[t("strong",lt,f(s.name||"名無し"),1),t("small",it,f(s.at),1),s.uid&&_.value&&s.uid===_.value.uid?(c(),i("button",{key:0,class:"btn-mini",type:"button",onClick:h=>ne(s.id)}," 削除 ",8,ct)):S("",!0)]),t("div",{class:"text",textContent:f(s.text)},null,8,ut)]))),128)),D.value.length===0?(c(),i("li",dt,"まだ投稿はありません。")):S("",!0)])]),e[16]||(e[16]=t("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])],512),[[Ce,p.value]])],64))}};function L(r){const a=document.createElement("pre");a.style.cssText="white-space:pre-wrap;padding:16px;background:#fff;color:#c00;border:1px solid #f99;font-family:monospace",a.textContent=`起動時エラー:
`+(r?.stack||r),document.body.innerHTML="",document.body.appendChild(a)}try{const r=Le(pt);r.config.errorHandler=a=>L(a),window.addEventListener("error",a=>L(a.error||a.message)),window.addEventListener("unhandledrejection",a=>L(a.reason)),r.mount("#app")}catch(r){L(r)}
//# sourceMappingURL=index-BYlDSfTf.js.map
