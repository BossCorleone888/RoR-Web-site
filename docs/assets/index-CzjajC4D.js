import{g as T,h as D,i as k,j as q,k as x,s as O,l as N,n as U,o as $,q as I,t as w,w as F,v as _,x as H,y as V,z as B,A as z,B as K,C as W}from"./vendor-CGyoh539.js";import{M as X}from"./markdown-BdO_TpYS.js";import"./firebase-BlrTpy7P.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&p(s)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const G="modulepreload",J=function(t){return"/RoR-Web-site/"+t},C={},E=function(e,a,p){let n=Promise.resolve();if(a&&a.length>0){let A=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");n=A(a.map(i=>{if(i=J(i),i in C)return;C[i]=!0;const d=i.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const c=document.createElement("link");if(c.rel=d?"stylesheet":G,d||(c.as="script"),c.crossOrigin="",c.href=i,r&&c.setAttribute("nonce",r),document.head.appendChild(c),d)return new Promise((P,v)=>{c.addEventListener("load",P),c.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return n.then(s=>{for(const r of s||[])r.status==="rejected"&&o(r.reason);return e().catch(o)})},j={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0},S=Object.entries(j).filter(([,t])=>!t).map(([t])=>t);if(S.length){const t=`[firebaseConfig] missing keys: ${S.join(", ")}`;console.error(t)}const M=T().length?D():k(j),Q=q(M),u=x(M);async function Y(t=1500){return u.currentUser!==null||await new Promise(e=>{const a=I(u,()=>{a(),e()});setTimeout(()=>{try{a()}catch{}e()},t)}),u.currentUser}async function Z(){try{await O(u,N)}catch{try{await O(u,U)}catch(a){console.error("[auth] setPersistence failed",a)}}const t=await Y();if(t)return t;if(typeof navigator<"u"&&navigator.onLine===!1)return console.warn("[auth] offline"),null;try{return(await $(u)).user}catch(e){return e?.code==="auth/network-request-failed"?(console.warn("[auth] network fail"),null):(console.error("[auth] anon failed",e),null)}}const ee=500,te=10,ne={__name:"App",setup(t){const e=new X({breaks:!0}),a=Object.assign({"./content/1.基本.md":()=>E(()=>import("./1.基本-BllvYrDA.js"),[]),"./content/2.players.md":()=>E(()=>import("./2.players-IYwVCbU4.js"),[]),"./content/3.略語集.md":()=>E(()=>import("./3.略語集-MdPddEiQ.js"),[]),"./content/4.リンク.md":()=>E(()=>import("./4.リンク-Bb9p9_Ht.js"),[])}),p=w([]),n=w(null),o=w("");async function s(){const l=[];for(const[h,f]of Object.entries(a)){const y=await f(),g=(y.split(/\r?\n/).find(R=>R.trim())||"").replace(/^#\s*/,""),L=h.split("/").pop().replace(/\.md$/,"");l.push({id:L,title:g||L,raw:y})}l.sort((h,f)=>h.id.localeCompare(f.id,"ja")),p.value=l,!n.value&&l.length&&(n.value=l[0].id)}F(n,()=>{const l=p.value.find(h=>h.id===n.value);o.value=l?e.render(l.raw):""}),w("");const r=w(""),A=w([]),i=_(()=>r.value.length),d=_(()=>r.value?r.value.split(/\r\n|\r|\n/).length:0),m=_(()=>i.value>ee),c=_(()=>d.value>te);_(()=>!!r.value.trim()&&!m.value&&!c.value);const P=H(Q,"messages"),v=w(null);return V(async()=>{console.log("[mounted] start"),await s();const l=await Z();v.value=l,console.log("[ensureAnonLogin] uid =",v.value?.uid),I(u,f=>{v.value=f,console.log("[onAuthStateChanged] uid =",f?.uid)}),window._auth=u,window._me=v,window._topics=p;const h=B(P,z("created_at","desc"));K(h,f=>{A.value=f.docs.map(y=>{const g=y.data(),L=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:y.id,name:g.name||"名無し",text:g.text||"",at:L.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",A.value[0])}),console.log("[mounted] done")}),()=>{}}};function b(t){const e=document.createElement("pre");e.style.cssText="white-space:pre-wrap;padding:16px;background:#fff;color:#c00;border:1px solid #f99;font-family:monospace",e.textContent=`起動時エラー:
`+(t?.stack||t),document.body.innerHTML="",document.body.appendChild(e)}try{const t=W(ne);t.config.errorHandler=e=>b(e),window.addEventListener("error",e=>b(e.error||e.message)),window.addEventListener("unhandledrejection",e=>b(e.reason)),t.mount("#app")}catch(t){b(t)}
//# sourceMappingURL=index-CzjajC4D.js.map
