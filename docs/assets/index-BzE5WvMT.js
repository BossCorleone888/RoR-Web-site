import{r as y,c as _,o as F,a as r,b as i,d as e,F as k,e as D,f as A,w as L,g as M,v as S,n as C,t as u,h as P,i as H}from"./vue-DIsLCQsJ.js";import{M as V}from"./markdown-BMSQkwth.js";import{g as Y,a as j,i as q,b as z,c as J,s as X,d as $,e as W,f as G,o as Q,q as Z,h as ee,j as te,k as se,l as R,m as oe,n as ne,p as ae}from"./firebase-D--XAbFQ.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function l(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function m(o){if(o.ep)return;o.ep=!0;const a=l(o);fetch(o.href,a)}})();const le={apiKey:"YOUR_WEB_API_KEY",authDomain:"YOUR_PROJECT_ID.firebaseapp.com",projectId:"YOUR_PROJECT_ID",appId:"YOUR_APP_ID"},b=Y().length?j():q(le),U=z(b),f=J(b);console.log("[firebase] projectId=",b.options.projectId," apiKey=",(b.options.apiKey||"").slice(0,8)+"...");async function re(){await X(f,W);try{if(f.currentUser)return f.currentUser;const c=await $(f);return console.log("[anon] ok uid=",c.user?.uid),c.user}catch(c){throw console.error("[anon] error code=",c?.code," message=",c?.message),c}}const ie={class:"layout-pc"},ce={class:"sidenav"},de={class:"sidenav-inner"},ue={"aria-label":"サイドナビ"},pe={class:"nav-list"},me=["onClick","aria-current"],ve={class:"nav-text"},fe={class:"content"},ge={class:"panel"},_e=["innerHTML"],he={key:1,class:"loading"},ye={class:"sidebar"},be={class:"pad"},we={class:"hint"},Ae={class:"row"},Ce=["disabled"],Ie={class:"card list"},Oe={class:"posts"},ke={class:"meta"},De={class:"name"},Le={class:"time"},Me=["onClick"],Se=["textContent"],Pe={key:0,class:"empty"},E=500,N=10,Re={__name:"App",setup(c){new V({breaks:!0});const p=y(""),l=y(""),m=y([]),o=_(()=>l.value.length),a=_(()=>l.value?l.value.split(/\r\n|\r|\n/).length:0),v=_(()=>o.value>E),I=_(()=>a.value>N),O=_(()=>!!l.value.trim()&&!v.value&&!I.value),w=G(U,"messages"),d=y(null);F(async()=>{console.log("[mounted] start");const n=await re();d.value=n,console.log("[ensureAnonLogin] uid =",d.value?.uid),Q(f,s=>{d.value=s,console.log("[onAuthStateChanged] uid =",s?.uid)}),window._auth=f,window._me=d;const t=Z(w,ee("created_at","desc"));te(t,s=>{m.value=s.docs.map(h=>{const g=h.data(),B=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:h.id,name:g.name||"名無し",text:g.text||"",at:B.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",m.value[0])}),console.log("[mounted] done")});function x(){const n=l.value.trim(),t=p.value.trim()||"名無し";O.value&&oe(w,{name:t,text:n,created_at:ae(),uid:d.value?.uid??null}).then(()=>{l.value="",console.log("[addDoc] ok, uid=",d.value?.uid)}).catch(s=>{console.error("[addDoc] error",s)})}async function T(n){try{console.log("[delete] try id=",n),await R(ne(U,"messages",n)),console.log("[delete] ok id=",n)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function K(){if(!confirm("全投稿を削除しますか？"))return;const n=await se(w);for(const t of n.docs)await R(t.ref)}return(n,t)=>(i(),r("div",ie,[e("aside",ce,[e("div",de,[t[3]||(t[3]=e("div",{class:"logo"},"MENU",-1)),e("nav",ue,[e("ul",pe,[(i(!0),r(k,null,D(n.topics,s=>(i(),r("li",{key:s.id},[e("a",{href:"#",class:C(["nav-link",{active:s.id===n.selectedId}]),onClick:L(h=>n.selectedId=s.id,["prevent"]),"aria-current":s.id===n.selectedId?"page":void 0},[t[2]||(t[2]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",ve,u(s.title),1)],10,me)]))),128))])])])]),e("main",fe,[t[4]||(t[4]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[5]||(t[5]=e("p",{class:"lead"},[A("ここではメンバー向けに "),e("strong",null,"ルール"),A(" や "),e("strong",null,"ノウハウ"),A(" を共有します。")],-1)),e("section",ge,[n.selectedHtml?(i(),r("article",{key:0,class:"md",innerHTML:n.selectedHtml},null,8,_e)):(i(),r("div",he,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",ye,[e("div",be,[t[10]||(t[10]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:L(x,["prevent"]),class:"card"},[t[7]||(t[7]=e("label",{class:"lbl"},"ニックネーム",-1)),M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[S,p.value]]),t[8]||(t[8]=e("label",{class:"lbl"},"メッセージ",-1)),M(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value=s),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[S,l.value]]),e("div",we,[e("span",{class:C({over:v.value})},u(o.value)+"/"+u(E)+"文字",3),t[6]||(t[6]=e("span",null,"・",-1)),e("span",{class:C({over:I.value})},u(a.value)+"/"+u(N)+"行",3)]),e("div",Ae,[e("button",{class:"btn-primary",type:"submit",disabled:!O.value},"投稿",8,Ce),e("button",{class:"btn-danger",type:"button",onClick:K},"全削除")])],32),e("div",Ie,[t[9]||(t[9]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",Oe,[(i(!0),r(k,null,D(m.value,s=>(i(),r("li",{key:s.id,class:"post"},[e("div",ke,[e("strong",De,u(s.name||"名無し"),1),e("small",Le,u(s.at),1),s.uid&&d.value&&s.uid===d.value.uid?(i(),r("button",{key:0,class:"btn-mini",type:"button",onClick:h=>T(s.id)}," 削除 ",8,Me)):P("",!0)]),e("div",{class:"text",textContent:u(s.text)},null,8,Se)]))),128)),m.value.length===0?(i(),r("li",Pe,"まだ投稿はありません。")):P("",!0)])]),t[11]||(t[11]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])]))}};H(Re).mount("#app");
