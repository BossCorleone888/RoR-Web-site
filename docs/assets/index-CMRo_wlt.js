import{r as b,c as h,o as R,a as c,b as d,d as e,F as L,e as M,f as w,w as S,g as D,v as I,n as k,t as f,h as O,i as K}from"./vue-DIsLCQsJ.js";import{M as $}from"./markdown-BMSQkwth.js";import{g as z,a as X,i as G,b as J,c as Q,s as P,d as W,e as Y,f as Z,o as T,h as ee,q as te,j as se,k as ne,l as oe,m as N,n as ae,p as le,r as re}from"./firebase-BHgPUD_C.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const v of r.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function m(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();const U={apiKey:void 0,authDomain:void 0,projectId:void 0,appId:void 0};{const i=Object.entries(U).filter(([,s])=>!s).map(([s])=>s);if(i.length){const s=`[firebaseConfig] missing keys: ${i.join(", ")}`;console.error(s)}}const H=z().length?X():G(U),x=J(H),u=Q(H);async function ie(i=5e3){return u.currentUser!==null||await new Promise(s=>{const a=T(u,()=>{a(),s()});setTimeout(()=>{try{a()}catch{}s()},i)}),u.currentUser}async function ce(){try{await P(u,W)}catch(s){console.warn("[auth] browserLocalPersistence unavailable, fallback to inMemory.",s?.code||s);try{await P(u,Y)}catch(a){console.error("[auth] setPersistence failed.",a?.code||a)}}const i=await ie(1500);if(i)return i;if(typeof navigator<"u"&&navigator&&navigator.onLine===!1)return console.warn("[auth] offline detected, skip signInAnonymously."),null;try{return(await Z(u)).user}catch(s){return s?.code==="auth/network-request-failed"?(console.warn("[auth] network-request-failed (offline or blocked). App continues without auth."),null):(console.error("[auth] anonymous sign-in failed:",s?.code,s?.message||s),null)}}const de={class:"layout-pc"},ue={class:"sidenav"},pe={class:"sidenav-inner"},fe={"aria-label":"サイドナビ"},me={class:"nav-list"},ve=["onClick","aria-current"],ge={class:"nav-text"},he={class:"content"},ye={class:"panel"},be=["innerHTML"],_e={key:1,class:"loading"},we={class:"sidebar"},ke={class:"pad"},Ae={class:"hint"},Ce={class:"row"},Le=["disabled"],Me={class:"card list"},Se={class:"posts"},De={class:"meta"},Ie={class:"name"},Oe={class:"time"},Pe=["onClick"],Ne=["textContent"],xe={key:0,class:"empty"},q=500,F=10,qe={__name:"App",setup(i){new $({breaks:!0});const s=b(""),a=b(""),m=b([]),o=h(()=>a.value.length),r=h(()=>a.value?a.value.split(/\r\n|\r|\n/).length:0),v=h(()=>o.value>q),A=h(()=>r.value>F),C=h(()=>!!a.value.trim()&&!v.value&&!A.value),_=ee(x,"messages"),p=b(null);R(async()=>{console.log("[mounted] start");const l=await ce();p.value=l,console.log("[ensureAnonLogin] uid =",p.value?.uid),T(u,n=>{p.value=n,console.log("[onAuthStateChanged] uid =",n?.uid)}),window._auth=u,window._me=p;const t=te(_,se("created_at","desc"));ne(t,n=>{m.value=n.docs.map(y=>{const g=y.data(),E=g.created_at?.toDate?g.created_at.toDate():new Date;return{id:y.id,name:g.name||"名無し",text:g.text||"",at:E.toLocaleString(),uid:g.uid??null}}),console.log("[onSnapshot] first=",m.value[0])}),console.log("[mounted] done")});function V(){const l=a.value.trim(),t=s.value.trim()||"名無し";C.value&&ae(_,{name:t,text:l,created_at:re(),uid:p.value?.uid??null}).then(()=>{a.value="",console.log("[addDoc] ok, uid=",p.value?.uid)}).catch(n=>{console.error("[addDoc] error",n)})}async function j(l){try{console.log("[delete] try id=",l),await N(le(x,"messages",l)),console.log("[delete] ok id=",l)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function B(){if(!confirm("全投稿を削除しますか？"))return;const l=await oe(_);for(const t of l.docs)await N(t.ref)}return(l,t)=>(d(),c("div",de,[e("aside",ue,[e("div",pe,[t[3]||(t[3]=e("div",{class:"logo"},"MENU",-1)),e("nav",fe,[e("ul",me,[(d(!0),c(L,null,M(l.topics,n=>(d(),c("li",{key:n.id},[e("a",{href:"#",class:k(["nav-link",{active:n.id===l.selectedId}]),onClick:S(y=>l.selectedId=n.id,["prevent"]),"aria-current":n.id===l.selectedId?"page":void 0},[t[2]||(t[2]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",ge,f(n.title),1)],10,ve)]))),128))])])])]),e("main",he,[t[4]||(t[4]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[5]||(t[5]=e("p",{class:"lead"},[w("ここではメンバー向けに "),e("strong",null,"ルール"),w(" や "),e("strong",null,"ノウハウ"),w(" を共有します。")],-1)),e("section",ye,[l.selectedHtml?(d(),c("article",{key:0,class:"md",innerHTML:l.selectedHtml},null,8,be)):(d(),c("div",_e,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",we,[e("div",ke,[t[10]||(t[10]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:S(V,["prevent"]),class:"card"},[t[7]||(t[7]=e("label",{class:"lbl"},"ニックネーム",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value=n),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[I,s.value]]),t[8]||(t[8]=e("label",{class:"lbl"},"メッセージ",-1)),D(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>a.value=n),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[I,a.value]]),e("div",Ae,[e("span",{class:k({over:v.value})},f(o.value)+"/"+f(q)+"文字",3),t[6]||(t[6]=e("span",null,"・",-1)),e("span",{class:k({over:A.value})},f(r.value)+"/"+f(F)+"行",3)]),e("div",Ce,[e("button",{class:"btn-primary",type:"submit",disabled:!C.value},"投稿",8,Le),e("button",{class:"btn-danger",type:"button",onClick:B},"全削除")])],32),e("div",Me,[t[9]||(t[9]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",Se,[(d(!0),c(L,null,M(m.value,n=>(d(),c("li",{key:n.id,class:"post"},[e("div",De,[e("strong",Ie,f(n.name||"名無し"),1),e("small",Oe,f(n.at),1),n.uid&&p.value&&n.uid===p.value.uid?(d(),c("button",{key:0,class:"btn-mini",type:"button",onClick:y=>j(n.id)}," 削除 ",8,Pe)):O("",!0)]),e("div",{class:"text",textContent:f(n.text)},null,8,Ne)]))),128)),m.value.length===0?(d(),c("li",xe,"まだ投稿はありません。")):O("",!0)])]),t[11]||(t[11]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])]))}};K(qe).mount("#app");
