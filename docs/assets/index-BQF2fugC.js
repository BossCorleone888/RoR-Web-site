import{r as _,c as g,o as E,a as i,b as d,d as e,F as L,e as M,f as w,w as S,g as D,v as I,n as C,t as p,h as O,i as K}from"./vue-DIsLCQsJ.js";import{M as R}from"./markdown-BMSQkwth.js";import{i as j,g as z,a as X,s as $,o as H,b as G,c as J,d as Q,q as W,e as Y,f as Z,h as ee,j as N,k as te,l as se,m as oe}from"./firebase-BG_A70aE.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function l(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=l(o);fetch(o.href,a)}})();const ne={apiKey:"...",authDomain:"...",projectId:"...",appId:"..."},T=j(ne),x=z(T),m=X(T);async function ae(){if(await $(m,J),m.currentUser)return m.currentUser;const h=await new Promise(l=>{const r=H(m,o=>{r(),l(o)})});return h||(await G(m)).user}const le={class:"layout-pc"},re={class:"sidenav"},ie={class:"sidenav-inner"},de={"aria-label":"サイドナビ"},ce={class:"nav-list"},ue=["onClick","aria-current"],pe={class:"nav-text"},me={class:"content"},ve={class:"panel"},fe=["innerHTML"],ge={key:1,class:"loading"},he={class:"sidebar"},ye={class:"pad"},_e={class:"hint"},be={class:"row"},we=["disabled"],Ce={class:"card list"},ke={class:"posts"},Ae={class:"meta"},Le={class:"name"},Me={class:"time"},Se=["onClick"],De=["textContent"],Ie={key:0,class:"empty"},P=500,F=10,Oe={__name:"App",setup(h){new R({breaks:!0});const c=_(""),l=_(""),r=_([]),o=g(()=>l.value.length),a=g(()=>l.value?l.value.split(/\r\n|\r|\n/).length:0),v=g(()=>o.value>P),k=g(()=>a.value>F),A=g(()=>!!l.value.trim()&&!v.value&&!k.value),b=Q(x,"messages"),u=_(null);E(async()=>{console.log("[mounted] start");const n=await ae();u.value=n,console.log("[ensureAnonLogin] uid =",u.value?.uid),H(m,s=>{u.value=s,console.log("[onAuthStateChanged] uid =",s?.uid)}),window._auth=m,window._me=u;const t=W(b,Y("created_at","desc"));Z(t,s=>{r.value=s.docs.map(y=>{const f=y.data(),B=f.created_at?.toDate?f.created_at.toDate():new Date;return{id:y.id,name:f.name||"名無し",text:f.text||"",at:B.toLocaleString(),uid:f.uid??null}}),console.log("[onSnapshot] first=",r.value[0])}),console.log("[mounted] done")});function U(){const n=l.value.trim(),t=c.value.trim()||"名無し";A.value&&te(b,{name:t,text:n,created_at:oe(),uid:u.value?.uid??null}).then(()=>{l.value="",console.log("[addDoc] ok, uid=",u.value?.uid)}).catch(s=>{console.error("[addDoc] error",s)})}async function V(n){try{console.log("[delete] try id=",n),await N(se(x,"messages",n)),console.log("[delete] ok id=",n)}catch(t){console.error("[delete] error",t),alert("削除に失敗したかも。コンソールを確認してね。")}}async function q(){if(!confirm("全投稿を削除しますか？"))return;const n=await ee(b);for(const t of n.docs)await N(t.ref)}return(n,t)=>(d(),i("div",le,[e("aside",re,[e("div",ie,[t[3]||(t[3]=e("div",{class:"logo"},"MENU",-1)),e("nav",de,[e("ul",ce,[(d(!0),i(L,null,M(n.topics,s=>(d(),i("li",{key:s.id},[e("a",{href:"#",class:C(["nav-link",{active:s.id===n.selectedId}]),onClick:S(y=>n.selectedId=s.id,["prevent"]),"aria-current":s.id===n.selectedId?"page":void 0},[t[2]||(t[2]=e("span",{class:"dot","aria-hidden":"true"},null,-1)),e("span",pe,p(s.title),1)],10,ue)]))),128))])])])]),e("main",me,[t[4]||(t[4]=e("h2",{class:"title"},"♠♡♦♧ RoRメンバーサイト ♠♡♦♧",-1)),t[5]||(t[5]=e("p",{class:"lead"},[w("ここではメンバー向けに "),e("strong",null,"ルール"),w(" や "),e("strong",null,"ノウハウ"),w(" を共有します。")],-1)),e("section",ve,[n.selectedHtml?(d(),i("article",{key:0,class:"md",innerHTML:n.selectedHtml},null,8,fe)):(d(),i("div",ge,"読み込み中…（content フォルダに .md を置くと自動で出るべ）"))])]),e("aside",he,[e("div",ye,[t[10]||(t[10]=e("h3",null,"✍️ メンバー書き込み",-1)),e("form",{onSubmit:S(U,["prevent"]),class:"card"},[t[7]||(t[7]=e("label",{class:"lbl"},"ニックネーム",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),class:"input",placeholder:"例：Momo56 / 名無し など"},null,512),[[I,c.value]]),t[8]||(t[8]=e("label",{class:"lbl"},"メッセージ",-1)),D(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value=s),class:"textarea",placeholder:"複数行OK。ノウハウや連絡事項などをどうぞ",rows:"5"},null,512),[[I,l.value]]),e("div",_e,[e("span",{class:C({over:v.value})},p(o.value)+"/"+p(P)+"文字",3),t[6]||(t[6]=e("span",null,"・",-1)),e("span",{class:C({over:k.value})},p(a.value)+"/"+p(F)+"行",3)]),e("div",be,[e("button",{class:"btn-primary",type:"submit",disabled:!A.value},"投稿",8,we),e("button",{class:"btn-danger",type:"button",onClick:q},"全削除")])],32),e("div",Ce,[t[9]||(t[9]=e("h4",null,"🗂 最新の投稿",-1)),e("ul",ke,[(d(!0),i(L,null,M(r.value,s=>(d(),i("li",{key:s.id,class:"post"},[e("div",Ae,[e("strong",Le,p(s.name||"名無し"),1),e("small",Me,p(s.at),1),s.uid&&u.value&&s.uid===u.value.uid?(d(),i("button",{key:0,class:"btn-mini",type:"button",onClick:y=>V(s.id)}," 削除 ",8,Se)):O("",!0)]),e("div",{class:"text",textContent:p(s.text)},null,8,De)]))),128)),r.value.length===0?(d(),i("li",Ie,"まだ投稿はありません。")):O("",!0)])]),t[11]||(t[11]=e("p",{class:"note"},"※ Firestoreでリアルタイム共有しています。",-1))])])]))}};K(Oe).mount("#app");
